<div class="auth-container" style="max-width: 600px;">
    <h1>Edit Profile</h1>

    {{#if error}}
    <div class="error" style="text-align: center; margin-bottom: 15px;">{{error}}</div>
    {{/if}}

    <form action="/edit-profile" method="POST" enctype="multipart/form-data">

        <!--edit username-->
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" value="{{user.username}}" required>
        </div>

        <!--change email-->
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" value="{{user.email}}" required>
        </div>

        <!-- borough dropdown -->
        <div class="form-group">
            <label for="borough">Borough</label>
            <select id="borough" name="borough" required>
                <option value="Manhattan" {{#equals user.borough "Manhattan" }}selected{{/equals}}>Manhattan</option>
                <option value="Brooklyn" {{#equals user.borough "Brooklyn" }}selected{{/equals}}>Brooklyn</option>
                <option value="Queens" {{#equals user.borough "Queens" }}selected{{/equals}}>Queens</option>
                <option value="Bronx" {{#equals user.borough "Bronx" }}selected{{/equals}}>Bronx</option>
                <option value="Staten Island" {{#equals user.borough "Staten Island" }}selected{{/equals}}>Staten Island
                </option>
                <option value="None" {{#equals user.borough "None" }}selected{{/equals}}>None</option>
            </select>
        </div>

        <!-- pfp  -->
        <div class="form-group">
            <label for="profile_picture">Profile Picture</label>
            {{#if user.profile_picture}}
            <div style="margin-bottom: 10px; text-align: center;">
                <img src="{{user.profile_picture}}" alt="Current Profile Picture"
                    style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
            </div>
            {{/if}}
            <input type="file" id="profile_picture" name="profile_picture" accept="image/*" style="padding: 10px;">
            <small style="color: #666; display: block; margin-top: 5px;">Upload a new image to replace your current
                picture.</small>
        </div>

        <!--sensitive content checkbox-->
        <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
            <input type="checkbox" id="hideSensitiveContent" name="hideSensitiveContent" {{#if
                user.hideSensitiveContent}}checked{{/if}} style="width: auto; margin: 0;">
            <label for="hideSensitiveContent" style="margin: 0; font-weight: normal; cursor: pointer;">Hide Sensitive
                Content</label>
        </div>
        <!--location & notifcation section -->
        <div class="section-divider">
            <p>Set your location to receive alerts when incidents are reported near you. Click on the map or use your current location.</p>

            <div class="form-group">
                <label for="address">Alert Location (Address)</label>
                <input
                    type="text"
                    id="address"
                    name="address"
                    placeholder="123 Main St, New York, NY"
                    value="{{user.address}}"
                    required
                >
                <small style="color: #667;">
                    Weâ€™ll use this address to notify you about nearby incidents.
                </small>
            </div>

            <div class="location-buttons" style="margin-top: 10px;">
                <button type="button" class="location-btn location-btn-primary" id="useCurrentLocation">
                    Use My Current Location
                </button>
                <button type="button" class="location-btn location-btn-secondary" id="clearAddress">
                    Clear Address
                </button>
            </div>


                <div id="locationStatus" class="location-status" style="display: none;"></div>
            </div>

            <div class="notification-settings">
                <div class="edit-profile-field">
                    <label for="notificationRadius">Radius for alerts</label>
                    <select id="notificationRadius" name="notificationRadius">
                        <option value="0.25" {{#equals user.notificationRadius "0.25"}}selected{{/equals}}>0.25 miles (1-2 blocks)</option>
                        <option value="0.5" {{#equals user.notificationRadius "0.5"}}selected{{/equals}}>0.5 miles (5-6 blocks)</option>
                        <option value="1" {{#equals user.notificationRadius "1"}}selected{{/equals}}>1 mile (default)</option>
                        <option value="2" {{#equals user.notificationRadius "2"}}selected{{/equals}}>2 miles</option>
                        <option value="5" {{#equals user.notificationRadius "5"}}selected{{/equals}}>5 miles</option>
                    </select>
                </div>

                <div class="checkbox-card">
                    <input type="checkbox" id="notificationsEnabled" name="notificationsEnabled"
                        {{#if user.notificationsEnabled}}checked{{/if}}>
                    <label for="notificationsEnabled">ðŸ”” Enable incident notifications near my location</label>
                </div>
            </div>
        </div>

        <!-- submit/cancel options -->
        <div class="form-actions" style="display: flex; gap: 10px; margin-top: 20px;">
            <button type="submit" class="button-primary" style="flex: 1;">Save Changes</button>
            <a href="/profile" class="button-secondary" style="flex: 1;">Cancel</a>
        </div>

    </form>
</div>
<script>
document.getElementById('useCurrentLocation')?.addEventListener('click', () => {
    if (!navigator.geolocation) {
        alert('Geolocation not supported');
        return;
    }

    navigator.geolocation.getCurrentPosition(async position => {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;

        const response = await fetch(
            `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`
        );
        const data = await response.json();

        if (data.display_name) {
            document.getElementById('address').value = data.display_name;
        }
    });
});

document.getElementById('clearAddress')?.addEventListener('click', () => {
    document.getElementById('address').value = '';
});
</script>
