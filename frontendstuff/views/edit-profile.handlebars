<div class="edit-profile-page">
    <h1>Edit Profile</h1>

    {{#if error}}
    <div class="error-message">{{error}}</div>
    {{/if}}

    <form action="/edit-profile" method="POST" class="edit-profile-form" enctype="multipart/form-data">

        <!--edit username-->
        <div class="edit-profile-field">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" value="{{user.username}}" required>
        </div>

        <!--change email-->
        <div class="edit-profile-field">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" value="{{user.email}}" required>
        </div>

        <!-- borough dropdown -->
        <div class="edit-profile-field">
            <label for="borough">Borough</label>
            <select id="borough" name="borough" required>
                <option value="Manhattan" {{#equals user.borough "Manhattan" }}selected{{/equals}}>Manhattan</option>
                <option value="Brooklyn" {{#equals user.borough "Brooklyn" }}selected{{/equals}}>Brooklyn</option>
                <option value="Queens" {{#equals user.borough "Queens" }}selected{{/equals}}>Queens</option>
                <option value="Bronx" {{#equals user.borough "Bronx" }}selected{{/equals}}>Bronx</option>
                <option value="Staten Island" {{#equals user.borough "Staten Island" }}selected{{/equals}}>Staten Island
                </option>
                <option value="None" {{#equals user.borough "None" }}selected{{/equals}}>None</option>
            </select>
        </div>

        <!-- pfp  -->
        <div class="edit-profile-field">
            <label for="profile_picture">Profile Picture</label>
            {{#if user.profile_picture}}
            <div class="current-pfp">
                <img src="{{user.profile_picture}}" alt="Current Profile Picture"
                    style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%; margin-bottom: 10px;">
            </div>
            {{/if}}
            <input type="file" id="profile_picture" name="profile_picture" accept="image/*">
        </div>

        <!--sensitive content checkbox-->
        <div class="edit-profile-field checkbox-group">
            <label for="hideSensitiveContent">
                <input type="checkbox" id="hideSensitiveContent" name="hideSensitiveContent" {{#if
                    user.hideSensitiveContent}}checked{{/if}}>
                Hide Sensitive Content
            </label>
        </div>
        <!--location & notifcation section -->
        <div class="section-divider">
            <p>Set your location to receive alerts when incidents are reported near you. Click on the map or use your current location.</p>

            <div class="location-section">
                <div id="location-map"></div>
                
                <div class="location-inputs">
                    <input type="text" id="latitude" name="latitude" placeholder="Latitude" 
                        value="{{user.location.latitude}}" readonly>
                    <input type="text" id="longitude" name="longitude" placeholder="Longitude" 
                        value="{{user.location.longitude}}" readonly>
                </div>

                <div class="location-buttons">
                    <button type="button" class="location-btn location-btn-primary" id="useCurrentLocation">
                        Use My Current Location
                    </button>
                    <button type="button" class="location-btn location-btn-secondary" id="clearLocation">
                        Clear Location
                    </button>
                </div>

                <div id="locationStatus" class="location-status" style="display: none;"></div>
            </div>

            <div class="notification-settings">
                <div class="edit-profile-field">
                    <label for="notificationRadius">Radius for alerts</label>
                    <select id="notificationRadius" name="notificationRadius">
                        <option value="0.25" {{#equals user.notificationRadius "0.25"}}selected{{/equals}}>0.25 miles (1-2 blocks)</option>
                        <option value="0.5" {{#equals user.notificationRadius "0.5"}}selected{{/equals}}>0.5 miles (5-6 blocks)</option>
                        <option value="1" {{#equals user.notificationRadius "1"}}selected{{/equals}}>1 mile (default)</option>
                        <option value="2" {{#equals user.notificationRadius "2"}}selected{{/equals}}>2 miles</option>
                        <option value="5" {{#equals user.notificationRadius "5"}}selected{{/equals}}>5 miles</option>
                    </select>
                </div>

                <div class="checkbox-card">
                    <input type="checkbox" id="notificationsEnabled" name="notificationsEnabled"
                        {{#if user.notificationsEnabled}}checked{{/if}}>
                    <label for="notificationsEnabled">ðŸ”” Enable incident notifications near my location</label>
                </div>
            </div>
        </div>

        <!-- submit/cancel options -->
        <div class="form-actions">
            <button type="submit" class="button-primary">
                Save Changes
            </button>
            <a href="/profile" class="button-secondary">
                Cancel
            </a>
        </div>

    </form>
</div>