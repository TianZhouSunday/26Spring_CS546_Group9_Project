<div class="post-detail">
    <article class="post-details {{#if post.sensitive}}sensitive{{/if}}">
        <div class="post-header">
            <h1>{{post.title}}</h1>
            {{#if post.sensitive}}
            <span class="sensitive-badge">Warning: Sensitive Content</span>
            {{/if}}
        </div>

        <div class="post-info">
            <!-- strong used for easy bolding/importance -->
            <p><strong>Posted:</strong> {{post.date}}</p>
            <p><strong>Location:</strong> {{post.location.latitude}}, {{post.location.longitude}}</p>
            <p><strong>Score:</strong> {{post.post_score}}</p>
            <p><strong>Posted by:</strong><a href="/user/{{post.user}}">{{user.username}}</a>
            </p>
        </div>

        {{#if (and post.sensitive currentUser.hideSensitiveContent)}}
        <details class="sensitive-content-container">
            <summary class="sensitive-warning">
                ⚠️ This post contains sensitive content (Click to view)
            </summary>

            {{#if post.photo}}
            <div class="post-photo">
                <img src="{{post.photo}}" alt="{{post.title}}">
            </div>
            {{/if}}

            {{#if post.body}}
            <div class="post-content">
                <h2>Description</h2>
                <p>{{post.body}}</p>
            </div>
            {{/if}}
        </details>
        {{else}}
        {{#if post.photo}}
        <div class="post-photo">
            <img src="{{post.photo}}" alt="{{post.title}}">
        </div>
        {{/if}}

        {{#if post.body}}
        <div class="post-content">
            <h2>Description</h2>
            <p>{{post.body}}</p>
        </div>
        {{/if}}
        {{/if}}

        <div class="post-actions">
            <a href="/posts" class="button">Back to Posts</a>

            {{#if (eq post.user currentUser._id)}}
            <form method="POST" action="/posts/{{post._id}}/delete" class="inline-form">
                <button type="submit" class="button-danger"
                    onclick="return confirm('Are you sure you want to delete this post?')">
                    Delete Post
                </button>
            </form>
            {{/if}}
        </div>

        {{#if post.comments.length}}
        <div class="comments-section">
            <h2>Comments ({{comments.length}})</h2>

            {{#each comments}}
            <div class="comment">
                <p class="comment-text">{{this.text}}</p>
                <p class="comment-meta">Score: {{this.score}}</p>

                {{#if (eq this.user ../currentUser._id)}}
                <form method="POST" action="/comments/{{this._id}}/delete" class="inline-form">
                    <input type="hidden" name="postId" value="{{../post._id}}">
                    <button type="submit" class="button-danger"
                        onclick="return confirm('Are you sure you want to delete this comment?')">
                        Delete
                    </button>
                </form>
                {{/if}}
            </div>
            {{/each}}
        </div>
        {{/if}}

        <div class="add-comment-section">
            <h3>Add a Comment</h3>
            <form method="POST" action="/posts/{{post._id}}/comment">
                <div class="form-group">
                    <textarea name="text" rows="3" placeholder="Write your comment..." required></textarea>
                </div>
                <button type="submit" class="button-primary">Post Comment</button>
            </form>
        </div>
    </article>
</div>